{"map":"{\"version\":3,\"sources\":[\"webpack/bootstrap\",\"/home/cib/theVelopment/midiaNinja/som-storage-api/index.js\",\"/home/cib/theVelopment/midiaNinja/som-storage-api/src/aws.repository.js\",\"/home/cib/theVelopment/midiaNinja/som-storage-api/src/images.js\",\"/home/cib/theVelopment/midiaNinja/som-storage-api/src/songs.js\",\"external \\\"aws-sdk\\\"\",\"external \\\"base64-img\\\"\",\"external \\\"dotenv\\\"\",\"external \\\"fs\\\"\",\"external \\\"imagemin\\\"\",\"external \\\"imagemin-jpeg-recompress\\\"\"],\"names\":[\"installedModules\",\"__webpack_require__\",\"moduleId\",\"exports\",\"module\",\"i\",\"l\",\"modules\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"__webpack_exports__\",\"uploadImageFunction\",\"uploadSongFunction\",\"dotenv__WEBPACK_IMPORTED_MODULE_0__\",\"dotenv__WEBPACK_IMPORTED_MODULE_0___default\",\"_src_images__WEBPACK_IMPORTED_MODULE_1__\",\"_src_songs__WEBPACK_IMPORTED_MODULE_2__\",\"dotenv\",\"config\",\"uploadImage\",\"uploadSong\",\"aws_sdk__WEBPACK_IMPORTED_MODULE_0__\",\"s3\",\"AWS\",\"S3\",\"signatureVersion\",\"upload\",\"body\",\"contentType\",\"Bucket\",\"console\",\"log\",\"params\",\"Body\",\"Key\",\"ACL\",\"ContentType\",\"Promise\",\"resolve\",\"reject\",\"err\",\"data\",\"remove\",\"base64_img__WEBPACK_IMPORTED_MODULE_0__\",\"base64_img__WEBPACK_IMPORTED_MODULE_0___default\",\"imagemin__WEBPACK_IMPORTED_MODULE_1__\",\"imagemin__WEBPACK_IMPORTED_MODULE_1___default\",\"imagemin_jpeg_recompress__WEBPACK_IMPORTED_MODULE_2__\",\"imagemin_jpeg_recompress__WEBPACK_IMPORTED_MODULE_2___default\",\"fs__WEBPACK_IMPORTED_MODULE_3__\",\"fs__WEBPACK_IMPORTED_MODULE_3___default\",\"_aws_repository__WEBPACK_IMPORTED_MODULE_4__\",\"async\",\"file\",\"id\",\"JSON\",\"parse\",\"event\",\"filename\",\"Date\",\"getTime\",\"replace\",\"base64Data\",\"Buffer\",\"from\",\"type\",\"filepath\",\"base64Img\",\"imgSync\",\"imagemin\",\"plugins\",\"imageminJpegRecompress\",\"loops\",\"quality\",\"urls\",\"originalResponse\",\"undefined\",\"original\",\"Location\",\"statusCode\",\"stringify\",\"error\",\"info\",\"mimifiedBuffer\",\"fs\",\"readFileSync\",\"mimifiedResponse\",\"mimified\",\"thumbnailBuffer\",\"thumbnailResponse\",\"thumbnail\",\"require\"],\"mappings\":\"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\",\"sourcesContent\":[\" \\t// The module cache\\n \\tvar installedModules = {};\\n\\n \\t// The require function\\n \\tfunction __webpack_require__(moduleId) {\\n\\n \\t\\t// Check if module is in cache\\n \\t\\tif(installedModules[moduleId]) {\\n \\t\\t\\treturn installedModules[moduleId].exports;\\n \\t\\t}\\n \\t\\t// Create a new module (and put it into the cache)\\n \\t\\tvar module = installedModules[moduleId] = {\\n \\t\\t\\ti: moduleId,\\n \\t\\t\\tl: false,\\n \\t\\t\\texports: {}\\n \\t\\t};\\n\\n \\t\\t// Execute the module function\\n \\t\\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n\\n \\t\\t// Flag the module as loaded\\n \\t\\tmodule.l = true;\\n\\n \\t\\t// Return the exports of the module\\n \\t\\treturn module.exports;\\n \\t}\\n\\n\\n \\t// expose the modules object (__webpack_modules__)\\n \\t__webpack_require__.m = modules;\\n\\n \\t// expose the module cache\\n \\t__webpack_require__.c = installedModules;\\n\\n \\t// define getter function for harmony exports\\n \\t__webpack_require__.d = function(exports, name, getter) {\\n \\t\\tif(!__webpack_require__.o(exports, name)) {\\n \\t\\t\\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\\n \\t\\t}\\n \\t};\\n\\n \\t// define __esModule on exports\\n \\t__webpack_require__.r = function(exports) {\\n \\t\\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\\n \\t\\t\\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\\n \\t\\t}\\n \\t\\tObject.defineProperty(exports, '__esModule', { value: true });\\n \\t};\\n\\n \\t// create a fake namespace object\\n \\t// mode & 1: value is a module id, require it\\n \\t// mode & 2: merge all properties of value into the ns\\n \\t// mode & 4: return value when already ns object\\n \\t// mode & 8|1: behave like require\\n \\t__webpack_require__.t = function(value, mode) {\\n \\t\\tif(mode & 1) value = __webpack_require__(value);\\n \\t\\tif(mode & 8) return value;\\n \\t\\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\\n \\t\\tvar ns = Object.create(null);\\n \\t\\t__webpack_require__.r(ns);\\n \\t\\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\\n \\t\\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\\n \\t\\treturn ns;\\n \\t};\\n\\n \\t// getDefaultExport function for compatibility with non-harmony modules\\n \\t__webpack_require__.n = function(module) {\\n \\t\\tvar getter = module && module.__esModule ?\\n \\t\\t\\tfunction getDefault() { return module['default']; } :\\n \\t\\t\\tfunction getModuleExports() { return module; };\\n \\t\\t__webpack_require__.d(getter, 'a', getter);\\n \\t\\treturn getter;\\n \\t};\\n\\n \\t// Object.prototype.hasOwnProperty.call\\n \\t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\\n\\n \\t// __webpack_public_path__\\n \\t__webpack_require__.p = \\\"\\\";\\n\\n\\n \\t// Load entry module and return exports\\n \\treturn __webpack_require__(__webpack_require__.s = \\\"./index.js\\\");\\n\",\"import dotenv from 'dotenv';\\n\\nimport {\\n  upload as uploadImage,\\n} from './src/images';\\nimport {\\n  upload as uploadSong,\\n} from './src/songs';\\n\\ndotenv.config();\\n\\nexport const uploadImageFunction = uploadImage;\\nexport const uploadSongFunction = uploadSong;\\n\",\"import AWS from 'aws-sdk';\\n\\nconst s3 = new AWS.S3({\\n  signatureVersion: 'v4',\\n});\\n/**\\n  * upload - That function upload file to aws s3\\n  *\\n  * @function upload\\n  * @param {string} body it's file data (binary)\\n  * @param {string} key it's bucket path\\n  * @param {string} contentType it's file content type\\n  * @returns {promise} with err or file storage data\\n  */\\nconst upload = (body, key, contentType = null, Bucket = 'som-dev-storage') => {\\n  console.log('Bucket: ', Bucket);\\n  const params = {\\n    Body: body,\\n    Bucket,\\n    Key: key,\\n    ACL: 'public-read',\\n  };\\n\\n  if (contentType) params.ContentType = contentType;\\n\\n  return new Promise((resolve, reject) => {\\n    s3.upload(params, (err, data) => {\\n      if (err) reject(err);\\n      else resolve(data);\\n    });\\n  });\\n};\\n\\nexport default ({\\n  upload,\\n});\\n\",\"import base64Img from 'base64-img';\\nimport imagemin from 'imagemin';\\nimport imageminJpegRecompress from 'imagemin-jpeg-recompress';\\nimport fs from 'fs';\\nimport s3 from './aws.repository';\\n/**\\n  * @function upload\\n  *\\n  * That function delete an credit card on wirecard api.\\n  * That action is irreversible.\\n  * For use that function make a GET request to\\n  *   /delete-credit-card?wirecardId=CRC-5TUWT121PNZY,\\n  *   the wirecardId in query, is the credit card id in Wirecard\\n  *\\n  * @method GET\\n  * @param {string} wirecardId\\n  */\\nexport const upload = async (event) => {\\n  const { file, id } = JSON.parse(event.body);\\n  const filename = `${new Date().getTime()}`;\\n  const data = file.replace(/^data:image\\\\/\\\\w+;base64,/, '');\\n  const base64Data = Buffer.from(data, 'base64');\\n  const rootDir = '/tmp';\\n  const originalTmpPath = `${rootDir}/originals/`;\\n  const mimifiedTmpPath = `${rootDir}/mimifieds/`;\\n  const thumbnailTmpPath = `${rootDir}/thumbnails/`;\\n  const key = type => `images/${id}/jpg/${type}/${filename}`;\\n\\n  const filepath = await base64Img.imgSync(\\n    `data:image/jpg;base64,${data}`,\\n    originalTmpPath,\\n    filename,\\n  );\\n\\n  await imagemin([filepath], mimifiedTmpPath, {\\n    plugins: [\\n      imageminJpegRecompress({\\n        loops: 4,\\n        quality: 'high',\\n      }),\\n    ],\\n  });\\n\\n  await imagemin([filepath], thumbnailTmpPath, {\\n    plugins: [\\n      imageminJpegRecompress({\\n        loops: 4,\\n        quality: 'low',\\n      }),\\n    ],\\n  });\\n\\n  const urls = {};\\n  console.log('urls: ', urls);\\n\\n  try {\\n    const originalResponse = await s3.upload(base64Data, `${key('originals')}.jpg`, 'image/jpeg', undefined);\\n    urls.original = originalResponse.Location;\\n  } catch (err) {\\n    console.log('Orifinal image error', err);\\n    return ({\\n      statusCode: 500,\\n      body: JSON.stringify({\\n        error: {\\n          type: 'upload_original_image',\\n          info: err,\\n        },\\n      }),\\n    });\\n  }\\n\\n  try {\\n    const mimifiedBuffer = await fs.readFileSync(`${mimifiedTmpPath + filename}.jpg`);\\n    const mimifiedResponse = await s3.upload(mimifiedBuffer, `${key('mimifieds')}.jpg`, 'image/jpeg', undefined);\\n    urls.mimified = mimifiedResponse.Location;\\n  } catch (err) {\\n    console.log('mimified image error', err);\\n    return ({\\n      statusCode: 500,\\n      body: JSON.stringify({\\n        error: {\\n          type: 'process_mimified_image',\\n          info: err,\\n        },\\n      }),\\n    });\\n  }\\n\\n  try {\\n    const thumbnailBuffer = await fs.readFileSync(`${thumbnailTmpPath + filename}.jpg`);\\n    const thumbnailResponse = await s3.upload(thumbnailBuffer, `${key('thumbnails')}.jpg`, 'image/jpeg', undefined);\\n    urls.thumbnail = thumbnailResponse.Location;\\n  } catch (err) {\\n    console.log('upload image error', err);\\n    return ({\\n      statusCode: 500,\\n      body: JSON.stringify({\\n        error: {\\n          type: 'process_thumbnail_image',\\n          info: err,\\n        },\\n      }),\\n    });\\n  }\\n\\n  console.log('urls: ', urls);\\n  return ({\\n    statusCode: 200,\\n    body: JSON.stringify({\\n      urls,\\n    }),\\n  });\\n};\\n\\nexport const remove = (event) => {\\n  console.log('here', event);\\n};\\n\\n// export const upload = (event) => {\\n// const multipartData = await multipart.parse(event);\\n//   if (multipartData.error) {\\n//     return ({\\n//       statusCode: 500,\\n//       body: JSON.stringify({\\n//         error: true,\\n//         msg: 'Internal Server Error',\\n//         info: 'internal_server_error',\\n//       }),\\n//     });\\n//   }\\n\\n//   const { file, info } = multipartData;\\n//   let fileData, filePath;\\n\\n//   if(types.findIndex(type => type === info.ext) === -1) {\\n//     return ({\\n//       statusCode: 401,\\n//       body: JSON.stringify({\\n//         error: true,\\n//         msg: 'not_support',\\n//         info: 'Image extension not supported',\\n//       }),\\n//     });\\n//   }\\n\\n//   const rootDir = process.cwd();\\n// await imagemin([file.path], rootDir+'/tmp', {\\n//   plugins: [\\n//     imageminJpegRecompress(),\\n//     imageminPngquant({ quality: '50-70' })\\n//   ]\\n// });\\n\\n//   filePath = rootDir + file.path;\\n//   fileData = await fileSystem.read(filePath);\\n//   const key = `image/${id}/${info.ext}/${fileId}.${info.ext}`;\\n\\n//   const result =\\n// await s3.upload(fileData, key, info.contentType, event.stageVariables.bucketName);\\n//   fileSystem.delete(filePath);\\n// }\\n\",\"// import base64Img from 'base64-img';\\n// import imagemin from 'imagemin';\\n// import imageminJpegRecompress from 'imagemin-jpeg-recompress';\\n// import fs from 'fs';\\n// import s3 from './aws.repository';\\n/**\\n  * @function upload\\n  *\\n  * That function delete an credit card on wirecard api.\\n  * That action is irreversible.\\n  * For use that function make a GET request to\\n  *   /delete-credit-card?wirecardId=CRC-5TUWT121PNZY,\\n  *   the wirecardId in query, is the credit card id in Wirecard\\n  *\\n  * @method GET\\n  * @param {string} wirecardId\\n  */\\nexport const upload = async (event) => {\\n  const { file/* , id */ } = JSON.parse(event.body);\\n  const filename = `${new Date().getTime()}`;\\n  const data = file.replace(/^data:audio\\\\/\\\\w+;base64,/, '');\\n  console.log('data: ', data);\\n\\n  return ({\\n    statusCode: 500,\\n    body: JSON.stringify({\\n      filename,\\n      data,\\n    }),\\n  });\\n\\n  // const base64Data = Buffer.from(data, 'base64');\\n  // const rootDir = '/tmp';\\n  // const originalTmpPath = `${rootDir}/originals/`;\\n  // const mimifiedTmpPath = `${rootDir}/mimifieds/`;\\n  // const thumbnailTmpPath = `${rootDir}/thumbnails/`;\\n  // const key = type => `songs/${id}/song/${type}/${filename}`;\\n\\n  // const filepath = await base64Img.imgSync(\\n  //   `data:image/jpg;base64,${data}`,\\n  //   originalTmpPath,\\n  //   filename,\\n  // );\\n\\n  // const urls = {};\\n  // console.log('urls: ', urls);\\n\\n  // try {\\n  //   const originalResponse = await s3.upload\\n  // (base64Data, `${key('originals')}.jpg`, 'image/jpeg', undefined);\\n  //   urls.original = originalResponse.Location;\\n  // } catch (err) {\\n  //   console.log('Orifinal image error', err);\\n  //   return ({\\n  //     statusCode: 500,\\n  //     body: JSON.stringify({\\n  //       error: {\\n  //         type: 'upload_original_image',\\n  //         info: err,\\n  //       },\\n  //     }),\\n  //   });\\n  // }\\n\\n  // console.log('urls: ', urls);\\n  // return ({\\n  //   statusCode: 200,\\n  //   body: JSON.stringify({\\n  //     filename,\\n  //     data,\\n  //     base64Data,\\n  //     rootDir,\\n  //   }),\\n  // });\\n};\\n\\nexport const remove = (event) => {\\n  console.log('here', event);\\n};\\n\\n// export const upload = (event) => {\\n// const multipartData = await multipart.parse(event);\\n//   if (multipartData.error) {\\n//     return ({\\n//       statusCode: 500,\\n//       body: JSON.stringify({\\n//         error: true,\\n//         msg: 'Internal Server Error',\\n//         info: 'internal_server_error',\\n//       }),\\n//     });\\n//   }\\n\\n//   const { file, info } = multipartData;\\n//   let fileData, filePath;\\n\\n//   if(types.findIndex(type => type === info.ext) === -1) {\\n//     return ({\\n//       statusCode: 401,\\n//       body: JSON.stringify({\\n//         error: true,\\n//         msg: 'not_support',\\n//         info: 'Image extension not supported',\\n//       }),\\n//     });\\n//   }\\n\\n//   const rootDir = process.cwd();\\n// await imagemin([file.path], rootDir+'/tmp', {\\n//   plugins: [\\n//     imageminJpegRecompress(),\\n//     imageminPngquant({ quality: '50-70' })\\n//   ]\\n// });\\n\\n//   filePath = rootDir + file.path;\\n//   fileData = await fileSystem.read(filePath);\\n//   const key = `image/${id}/${info.ext}/${fileId}.${info.ext}`;\\n\\n//   const result =\\n// await s3.upload(fileData, key, info.contentType, event.stageVariables.bucketName);\\n//   fileSystem.delete(filePath);\\n// }\\n\",\"module.exports = require(\\\"aws-sdk\\\");\",\"module.exports = require(\\\"base64-img\\\");\",\"module.exports = require(\\\"dotenv\\\");\",\"module.exports = require(\\\"fs\\\");\",\"module.exports = require(\\\"imagemin\\\");\",\"module.exports = require(\\\"imagemin-jpeg-recompress\\\");\"]}","code":"module.exports=function(e){var o={};function t(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=o,t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:n})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&o&&\"string\"!=typeof e)for(var r in e)t.d(n,r,function(o){return e[o]}.bind(null,r));return n},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,\"a\",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p=\"\",t(t.s=\"./index.js\")}({\"./index.js\":\n/*!******************!*\\\n  !*** ./index.js ***!\n  \\******************/\n/*! exports provided: uploadImageFunction, uploadSongFunction */function(e,o,t){\"use strict\";t.r(o),t.d(o,\"uploadImageFunction\",function(){return s}),t.d(o,\"uploadSongFunction\",function(){return u});var n=t(/*! dotenv */\"dotenv\"),r=t.n(n),i=t(/*! ./src/images */\"./src/images.js\"),a=t(/*! ./src/songs */\"./src/songs.js\");r.a.config();const s=i.upload,u=a.upload},\"./src/aws.repository.js\":\n/*!*******************************!*\\\n  !*** ./src/aws.repository.js ***!\n  \\*******************************/\n/*! exports provided: default */function(e,o,t){\"use strict\";t.r(o);var n=t(/*! aws-sdk */\"aws-sdk\");const r=new(t.n(n).a.S3)({signatureVersion:\"v4\"});o.default={upload:(e,o,t=null,n=\"som-dev-storage\")=>{console.log(\"Bucket: \",n);const i={Body:e,Bucket:n,Key:o,ACL:\"public-read\"};return t&&(i.ContentType=t),new Promise((e,o)=>{r.upload(i,(t,n)=>{t?o(t):e(n)})})}}},\"./src/images.js\":\n/*!***********************!*\\\n  !*** ./src/images.js ***!\n  \\***********************/\n/*! exports provided: upload, remove */function(e,o,t){\"use strict\";t.r(o),t.d(o,\"upload\",function(){return p}),t.d(o,\"remove\",function(){return g});var n=t(/*! base64-img */\"base64-img\"),r=t.n(n),i=t(/*! imagemin */\"imagemin\"),a=t.n(i),s=t(/*! imagemin-jpeg-recompress */\"imagemin-jpeg-recompress\"),u=t.n(s),c=t(/*! fs */\"fs\"),l=t.n(c),d=t(/*! ./aws.repository */\"./src/aws.repository.js\");const p=async e=>{const{file:o,id:t}=JSON.parse(e.body),n=`${(new Date).getTime()}`,i=o.replace(/^data:image\\/\\w+;base64,/,\"\"),s=Buffer.from(i,\"base64\"),c=e=>`images/${t}/jpg/${e}/${n}`,p=await r.a.imgSync(`data:image/jpg;base64,${i}`,\"/tmp/originals/\",n);await a()([p],\"/tmp/mimifieds/\",{plugins:[u()({loops:4,quality:\"high\"})]}),await a()([p],\"/tmp/thumbnails/\",{plugins:[u()({loops:4,quality:\"low\"})]});const g={};console.log(\"urls: \",g);try{const e=await d.default.upload(s,`${c(\"originals\")}.jpg`,\"image/jpeg\",void 0);g.original=e.Location}catch(e){return console.log(\"Orifinal image error\",e),{statusCode:500,body:JSON.stringify({error:{type:\"upload_original_image\",info:e}})}}try{const e=await l.a.readFileSync(`${\"/tmp/mimifieds/\"+n}.jpg`),o=await d.default.upload(e,`${c(\"mimifieds\")}.jpg`,\"image/jpeg\",void 0);g.mimified=o.Location}catch(e){return console.log(\"mimified image error\",e),{statusCode:500,body:JSON.stringify({error:{type:\"process_mimified_image\",info:e}})}}try{const e=await l.a.readFileSync(`${\"/tmp/thumbnails/\"+n}.jpg`),o=await d.default.upload(e,`${c(\"thumbnails\")}.jpg`,\"image/jpeg\",void 0);g.thumbnail=o.Location}catch(e){return console.log(\"upload image error\",e),{statusCode:500,body:JSON.stringify({error:{type:\"process_thumbnail_image\",info:e}})}}return console.log(\"urls: \",g),{statusCode:200,body:JSON.stringify({urls:g})}},g=e=>{console.log(\"here\",e)}},\"./src/songs.js\":\n/*!**********************!*\\\n  !*** ./src/songs.js ***!\n  \\**********************/\n/*! exports provided: upload, remove */function(e,o,t){\"use strict\";t.r(o),t.d(o,\"upload\",function(){return n}),t.d(o,\"remove\",function(){return r});const n=async e=>{const{file:o}=JSON.parse(e.body),t=`${(new Date).getTime()}`,n=o.replace(/^data:audio\\/\\w+;base64,/,\"\");return console.log(\"data: \",n),{statusCode:500,body:JSON.stringify({filename:t,data:n})}},r=e=>{console.log(\"here\",e)}},\"aws-sdk\":\n/*!**************************!*\\\n  !*** external \"aws-sdk\" ***!\n  \\**************************/\n/*! no static exports found */function(e,o){e.exports=require(\"aws-sdk\")},\"base64-img\":\n/*!*****************************!*\\\n  !*** external \"base64-img\" ***!\n  \\*****************************/\n/*! no static exports found */function(e,o){e.exports=require(\"base64-img\")},dotenv:\n/*!*************************!*\\\n  !*** external \"dotenv\" ***!\n  \\*************************/\n/*! no static exports found */function(e,o){e.exports=require(\"dotenv\")},fs:\n/*!*********************!*\\\n  !*** external \"fs\" ***!\n  \\*********************/\n/*! no static exports found */function(e,o){e.exports=require(\"fs\")},imagemin:\n/*!***************************!*\\\n  !*** external \"imagemin\" ***!\n  \\***************************/\n/*! no static exports found */function(e,o){e.exports=require(\"imagemin\")},\"imagemin-jpeg-recompress\":\n/*!*******************************************!*\\\n  !*** external \"imagemin-jpeg-recompress\" ***!\n  \\*******************************************/\n/*! no static exports found */function(e,o){e.exports=require(\"imagemin-jpeg-recompress\")}});","extractedComments":[]}