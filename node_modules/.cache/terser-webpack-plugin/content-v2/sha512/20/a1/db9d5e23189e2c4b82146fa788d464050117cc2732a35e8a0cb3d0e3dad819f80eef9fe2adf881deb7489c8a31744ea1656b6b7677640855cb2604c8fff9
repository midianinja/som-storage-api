{"map":"{\"version\":3,\"sources\":[\"webpack/bootstrap\",\"/home/cib/theVelopment/midiaNinja/som-storage-api/index.js\",\"/home/cib/theVelopment/midiaNinja/som-storage-api/src/aws.repository.js\",\"/home/cib/theVelopment/midiaNinja/som-storage-api/src/images.js\",\"external \\\"aws-sdk\\\"\",\"external \\\"base64-img\\\"\",\"external \\\"dotenv\\\"\",\"external \\\"fs\\\"\",\"external \\\"imagemin\\\"\",\"external \\\"imagemin-jpeg-recompress\\\"\"],\"names\":[\"installedModules\",\"__webpack_require__\",\"moduleId\",\"exports\",\"module\",\"i\",\"l\",\"modules\",\"call\",\"m\",\"c\",\"d\",\"name\",\"getter\",\"o\",\"Object\",\"defineProperty\",\"enumerable\",\"get\",\"r\",\"Symbol\",\"toStringTag\",\"value\",\"t\",\"mode\",\"__esModule\",\"ns\",\"create\",\"key\",\"bind\",\"n\",\"object\",\"property\",\"prototype\",\"hasOwnProperty\",\"p\",\"s\",\"__webpack_exports__\",\"uploadImagesFunction\",\"fake\",\"dotenv__WEBPACK_IMPORTED_MODULE_0__\",\"dotenv__WEBPACK_IMPORTED_MODULE_0___default\",\"_src_images__WEBPACK_IMPORTED_MODULE_1__\",\"dotenv\",\"config\",\"uploadImages\",\"aws_sdk__WEBPACK_IMPORTED_MODULE_0__\",\"s3\",\"AWS\",\"S3\",\"signatureVersion\",\"upload\",\"body\",\"contentType\",\"Bucket\",\"console\",\"log\",\"params\",\"Body\",\"Key\",\"ACL\",\"ContentType\",\"Promise\",\"resolve\",\"reject\",\"err\",\"data\",\"remove\",\"base64_img__WEBPACK_IMPORTED_MODULE_0__\",\"base64_img__WEBPACK_IMPORTED_MODULE_0___default\",\"imagemin__WEBPACK_IMPORTED_MODULE_1__\",\"imagemin__WEBPACK_IMPORTED_MODULE_1___default\",\"imagemin_jpeg_recompress__WEBPACK_IMPORTED_MODULE_2__\",\"imagemin_jpeg_recompress__WEBPACK_IMPORTED_MODULE_2___default\",\"fs__WEBPACK_IMPORTED_MODULE_3__\",\"fs__WEBPACK_IMPORTED_MODULE_3___default\",\"_aws_repository__WEBPACK_IMPORTED_MODULE_4__\",\"async\",\"file\",\"id\",\"JSON\",\"parse\",\"event\",\"filename\",\"Date\",\"getTime\",\"replace\",\"base64Data\",\"Buffer\",\"from\",\"type\",\"filepath\",\"base64Img\",\"imgSync\",\"imagemin\",\"plugins\",\"imageminJpegRecompress\",\"loops\",\"quality\",\"urls\",\"originalResponse\",\"undefined\",\"original\",\"Location\",\"statusCode\",\"stringify\",\"error\",\"info\",\"mimifiedBuffer\",\"fs\",\"readFileSync\",\"mimifiedResponse\",\"mimified\",\"thumbnailBuffer\",\"thumbnailResponse\",\"thumbnail\",\"require\"],\"mappings\":\"2BACA,IAAAA,EAAA,GAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAC,QAGA,IAAAC,EAAAJ,EAAAE,GAAA,CACAG,EAAAH,EACAI,GAAA,EACAH,QAAA,IAUA,OANAI,EAAAL,GAAAM,KAAAJ,EAAAD,QAAAC,EAAAA,EAAAD,QAAAF,GAGAG,EAAAE,GAAA,EAGAF,EAAAD,QA0DA,OArDAF,EAAAQ,EAAAF,EAGAN,EAAAS,EAAAV,EAGAC,EAAAU,EAAA,SAAAR,EAAAS,EAAAC,GACAZ,EAAAa,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,EAAA,CAA0CK,YAAA,EAAAC,IAAAL,KAK1CZ,EAAAkB,EAAA,SAAAhB,GACA,oBAAAiB,QAAAA,OAAAC,aACAN,OAAAC,eAAAb,EAAAiB,OAAAC,YAAA,CAAwDC,MAAA,WAExDP,OAAAC,eAAAb,EAAA,aAAA,CAAiDmB,OAAA,KAQjDrB,EAAAsB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAArB,EAAAqB,IACA,EAAAE,EAAA,OAAAF,EACA,GAAA,EAAAE,GAAA,iBAAAF,GAAAA,GAAAA,EAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFA1B,EAAAkB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,UAAA,CAAyCT,YAAA,EAAAK,MAAAA,IACzC,EAAAE,GAAA,iBAAAF,EAAA,IAAA,IAAAM,KAAAN,EAAArB,EAAAU,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAzB,EAAA6B,EAAA,SAAA1B,GACA,IAAAS,EAAAT,GAAAA,EAAAqB,WACA,WAA2B,OAAArB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAH,EAAAU,EAAAE,EAAA,IAAAA,GACAA,GAIAZ,EAAAa,EAAA,SAAAiB,EAAAC,GAAsD,OAAAjB,OAAAkB,UAAAC,eAAA1B,KAAAuB,EAAAC,IAGtD/B,EAAAkC,EAAA,GAIAlC,EAAAA,EAAAmC,EAAA;;;;gFClFAnC,EAAAkB,EAAAkB,GAAApC,EAAAU,EAAA0B,EAAA,uBAAA,WAAA,OAAAC,IAAArC,EAAAU,EAAA0B,EAAA,OAAA,WAAA,OAAAE,IAAA,IAAAC,EAAAvC,eAAA,UAAAwC,EAAAxC,EAAA6B,EAAAU,GAAAE,EAAAzC,qBAAA,mBAMA0C,EAAAA,EAAOC,SACA,MAAMN,EAAuBO,EAAAA,OACvBN,EAAO,IAAM;;;;6DCR1BtC,EAAAkB,EAAAkB,GAAA,IAAAS,EAAA7C,gBAAA,WAEA,MAAM8C,EAAK,IAFX9C,EAAA6B,EAAAgB,GAEeE,EAAIC,IAAG,CACpBC,iBAAkB,OA8BJb,EAAA,QAAA,CACdc,OApBa,CAACC,EAAMxB,EAAKyB,EAAc,KAAMC,EAAS,qBACtDC,QAAQC,IAAI,WAAYF,GACxB,MAAMG,EAAS,CACbC,KAAMN,EACNE,OAAAA,EACAK,IAAK/B,EACLgC,IAAK,eAKP,OAFIP,IAAaI,EAAOI,YAAcR,GAE/B,IAAIS,QAAQ,CAACC,EAASC,KAC3BjB,EAAGI,OAAOM,EAAQ,CAACQ,EAAKC,KAClBD,EAAKD,EAAOC,GACXF,EAAQG;;;;oEC5BnBjE,EAAAkB,EAAAkB,GAAApC,EAAAU,EAAA0B,EAAA,SAAA,WAAA,OAAAc,IAAAlD,EAAAU,EAAA0B,EAAA,SAAA,WAAA,OAAA8B,IAAA,IAAAC,EAAAnE,mBAAA,cAAAoE,EAAApE,EAAA6B,EAAAsC,GAAAE,EAAArE,iBAAA,YAAAsE,EAAAtE,EAAA6B,EAAAwC,GAAAE,EAAAvE,iCAAA,4BAAAwE,EAAAxE,EAAA6B,EAAA0C,GAAAE,EAAAzE,WAAA,MAAA0E,EAAA1E,EAAA6B,EAAA4C,GAAAE,EAAA3E,yBAAA,2BAiBO,MAAMkD,EAAS0B,MAAAA,IACpB,MAAMC,KAAEA,EAAFC,GAAQA,GAAOC,KAAKC,MAAMC,EAAM9B,MAChC+B,MAAc,IAAIC,MAAOC,YACzBnB,EAAOY,EAAKQ,QAAQ,2BAA4B,IAChDC,EAAaC,OAAOC,KAAKvB,EAAM,UAK/BtC,EAAM8D,aAAkBX,SAAUW,KAAQP,IAE1CQ,QAAiBC,EAAAA,EAAUC,iCACN3B,IANF,kBAQvBiB,SAGIW,GAAAA,CAAS,CAACH,GAVS,kBAUmB,CAC1CI,QAAS,CACPC,GAAAA,CAAuB,CACrBC,MAAO,EACPC,QAAS,kBAKTJ,GAAAA,CAAS,CAACH,GAlBU,mBAkBmB,CAC3CI,QAAS,CACPC,GAAAA,CAAuB,CACrBC,MAAO,EACPC,QAAS,WAKf,MAAMC,EAAO,GACb5C,QAAQC,IAAI,SAAU2C,GAEtB,IACE,MAAMC,QAAyBrD,EAAAA,QAAGI,OAAOoC,KAAe3D,EAAI,mBAAoB,kBAAcyE,GAC9FF,EAAKG,SAAWF,EAAiBG,SACjC,MAAOtC,GAEP,OADAV,QAAQC,IAAI,uBAAwBS,GAC5B,CACNuC,WAAY,IACZpD,KAAM4B,KAAKyB,UAAU,CACnBC,MAAO,CACLhB,KAAM,wBACNiB,KAAM1C,MAMd,IACE,MAAM2C,QAAuBC,EAAAA,EAAGC,gBAhDT,kBAgD2C3B,SAC5D4B,QAAyBhE,EAAAA,QAAGI,OAAOyD,KAAmBhF,EAAI,mBAAoB,kBAAcyE,GAClGF,EAAKa,SAAWD,EAAiBR,SACjC,MAAOtC,GAEP,OADAV,QAAQC,IAAI,uBAAwBS,GAC5B,CACNuC,WAAY,IACZpD,KAAM4B,KAAKyB,UAAU,CACnBC,MAAO,CACLhB,KAAM,yBACNiB,KAAM1C,MAMd,IACE,MAAMgD,QAAwBJ,EAAAA,EAAGC,gBAhET,mBAgE4C3B,SAC9D+B,QAA0BnE,EAAAA,QAAGI,OAAO8D,KAAoBrF,EAAI,oBAAqB,kBAAcyE,GACrGF,EAAKgB,UAAYD,EAAkBX,SACnC,MAAOtC,GAEP,OADAV,QAAQC,IAAI,qBAAsBS,GAC1B,CACNuC,WAAY,IACZpD,KAAM4B,KAAKyB,UAAU,CACnBC,MAAO,CACLhB,KAAM,0BACNiB,KAAM1C,MAOd,OADAV,QAAQC,IAAI,SAAU2C,GACd,CACNK,WAAY,IACZpD,KAAM4B,KAAKyB,UAAU,CACnBN,KAAAA,MAKOhC,EAAUe,IACrB3B,QAAQC,IAAI,OAAQ0B;;;;4CCnHtB9E,EAAAD,QAAAiH,QAAA;;;;4CCAAhH,EAAAD,QAAAiH,QAAA;;;;4CCAAhH,EAAAD,QAAAiH,QAAA;;;;4CCAAhH,EAAAD,QAAAiH,QAAA;;;;4CCAAhH,EAAAD,QAAAiH,QAAA;;;;4CCAAhH,EAAAD,QAAAiH,QAAA\",\"sourcesContent\":[\" \\t// The module cache\\n \\tvar installedModules = {};\\n\\n \\t// The require function\\n \\tfunction __webpack_require__(moduleId) {\\n\\n \\t\\t// Check if module is in cache\\n \\t\\tif(installedModules[moduleId]) {\\n \\t\\t\\treturn installedModules[moduleId].exports;\\n \\t\\t}\\n \\t\\t// Create a new module (and put it into the cache)\\n \\t\\tvar module = installedModules[moduleId] = {\\n \\t\\t\\ti: moduleId,\\n \\t\\t\\tl: false,\\n \\t\\t\\texports: {}\\n \\t\\t};\\n\\n \\t\\t// Execute the module function\\n \\t\\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n\\n \\t\\t// Flag the module as loaded\\n \\t\\tmodule.l = true;\\n\\n \\t\\t// Return the exports of the module\\n \\t\\treturn module.exports;\\n \\t}\\n\\n\\n \\t// expose the modules object (__webpack_modules__)\\n \\t__webpack_require__.m = modules;\\n\\n \\t// expose the module cache\\n \\t__webpack_require__.c = installedModules;\\n\\n \\t// define getter function for harmony exports\\n \\t__webpack_require__.d = function(exports, name, getter) {\\n \\t\\tif(!__webpack_require__.o(exports, name)) {\\n \\t\\t\\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\\n \\t\\t}\\n \\t};\\n\\n \\t// define __esModule on exports\\n \\t__webpack_require__.r = function(exports) {\\n \\t\\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\\n \\t\\t\\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\\n \\t\\t}\\n \\t\\tObject.defineProperty(exports, '__esModule', { value: true });\\n \\t};\\n\\n \\t// create a fake namespace object\\n \\t// mode & 1: value is a module id, require it\\n \\t// mode & 2: merge all properties of value into the ns\\n \\t// mode & 4: return value when already ns object\\n \\t// mode & 8|1: behave like require\\n \\t__webpack_require__.t = function(value, mode) {\\n \\t\\tif(mode & 1) value = __webpack_require__(value);\\n \\t\\tif(mode & 8) return value;\\n \\t\\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\\n \\t\\tvar ns = Object.create(null);\\n \\t\\t__webpack_require__.r(ns);\\n \\t\\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\\n \\t\\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\\n \\t\\treturn ns;\\n \\t};\\n\\n \\t// getDefaultExport function for compatibility with non-harmony modules\\n \\t__webpack_require__.n = function(module) {\\n \\t\\tvar getter = module && module.__esModule ?\\n \\t\\t\\tfunction getDefault() { return module['default']; } :\\n \\t\\t\\tfunction getModuleExports() { return module; };\\n \\t\\t__webpack_require__.d(getter, 'a', getter);\\n \\t\\treturn getter;\\n \\t};\\n\\n \\t// Object.prototype.hasOwnProperty.call\\n \\t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\\n\\n \\t// __webpack_public_path__\\n \\t__webpack_require__.p = \\\"\\\";\\n\\n\\n \\t// Load entry module and return exports\\n \\treturn __webpack_require__(__webpack_require__.s = \\\"./index.js\\\");\\n\",\"import dotenv from 'dotenv';\\n\\nimport {\\n  upload as uploadImages,\\n} from './src/images';\\n\\ndotenv.config();\\nexport const uploadImagesFunction = uploadImages;\\nexport const fake = () => null;\\n\",\"import AWS from 'aws-sdk';\\n\\nconst s3 = new AWS.S3({\\n  signatureVersion: 'v4',\\n});\\n/**\\n  * upload - That function upload file to aws s3\\n  *\\n  * @function upload\\n  * @param {string} body it's file data (binary)\\n  * @param {string} key it's bucket path\\n  * @param {string} contentType it's file content type\\n  * @returns {promise} with err or file storage data\\n  */\\nconst upload = (body, key, contentType = null, Bucket = 'som-dev-storage') => {\\n  console.log('Bucket: ', Bucket);\\n  const params = {\\n    Body: body,\\n    Bucket,\\n    Key: key,\\n    ACL: 'public-read',\\n  };\\n\\n  if (contentType) params.ContentType = contentType;\\n\\n  return new Promise((resolve, reject) => {\\n    s3.upload(params, (err, data) => {\\n      if (err) reject(err);\\n      else resolve(data);\\n    });\\n  });\\n};\\n\\nexport default ({\\n  upload,\\n});\\n\",\"import base64Img from 'base64-img';\\nimport imagemin from 'imagemin';\\nimport imageminJpegRecompress from 'imagemin-jpeg-recompress';\\nimport fs from 'fs';\\nimport s3 from './aws.repository';\\n/**\\n  * @function upload\\n  *\\n  * That function delete an credit card on wirecard api.\\n  * That action is irreversible.\\n  * For use that function make a GET request to\\n  *   /delete-credit-card?wirecardId=CRC-5TUWT121PNZY,\\n  *   the wirecardId in query, is the credit card id in Wirecard\\n  *\\n  * @method GET\\n  * @param {string} wirecardId\\n  */\\nexport const upload = async (event) => {\\n  const { file, id } = JSON.parse(event.body);\\n  const filename = `${new Date().getTime()}`;\\n  const data = file.replace(/^data:image\\\\/\\\\w+;base64,/, '');\\n  const base64Data = Buffer.from(data, 'base64');\\n  const rootDir = '/tmp';\\n  const originalTmpPath = `${rootDir}/originals/`;\\n  const mimifiedTmpPath = `${rootDir}/mimifieds/`;\\n  const thumbnailTmpPath = `${rootDir}/thumbnails/`;\\n  const key = type => `images/${id}/jpg/${type}/${filename}`;\\n\\n  const filepath = await base64Img.imgSync(\\n    `data:image/jpg;base64,${data}`,\\n    originalTmpPath,\\n    filename,\\n  );\\n\\n  await imagemin([filepath], mimifiedTmpPath, {\\n    plugins: [\\n      imageminJpegRecompress({\\n        loops: 4,\\n        quality: 'high',\\n      }),\\n    ],\\n  });\\n\\n  await imagemin([filepath], thumbnailTmpPath, {\\n    plugins: [\\n      imageminJpegRecompress({\\n        loops: 4,\\n        quality: 'low',\\n      }),\\n    ],\\n  });\\n\\n  const urls = {};\\n  console.log('urls: ', urls);\\n\\n  try {\\n    const originalResponse = await s3.upload(base64Data, `${key('originals')}.jpg`, 'image/jpeg', undefined);\\n    urls.original = originalResponse.Location;\\n  } catch (err) {\\n    console.log('Orifinal image error', err);\\n    return ({\\n      statusCode: 500,\\n      body: JSON.stringify({\\n        error: {\\n          type: 'upload_original_image',\\n          info: err,\\n        },\\n      }),\\n    });\\n  }\\n\\n  try {\\n    const mimifiedBuffer = await fs.readFileSync(`${mimifiedTmpPath + filename}.jpg`);\\n    const mimifiedResponse = await s3.upload(mimifiedBuffer, `${key('mimifieds')}.jpg`, 'image/jpeg', undefined);\\n    urls.mimified = mimifiedResponse.Location;\\n  } catch (err) {\\n    console.log('mimified image error', err);\\n    return ({\\n      statusCode: 500,\\n      body: JSON.stringify({\\n        error: {\\n          type: 'process_mimified_image',\\n          info: err,\\n        },\\n      }),\\n    });\\n  }\\n\\n  try {\\n    const thumbnailBuffer = await fs.readFileSync(`${thumbnailTmpPath + filename}.jpg`);\\n    const thumbnailResponse = await s3.upload(thumbnailBuffer, `${key('thumbnails')}.jpg`, 'image/jpeg', undefined);\\n    urls.thumbnail = thumbnailResponse.Location;\\n  } catch (err) {\\n    console.log('upload image error', err);\\n    return ({\\n      statusCode: 500,\\n      body: JSON.stringify({\\n        error: {\\n          type: 'process_thumbnail_image',\\n          info: err,\\n        },\\n      }),\\n    });\\n  }\\n\\n  console.log('urls: ', urls);\\n  return ({\\n    statusCode: 200,\\n    body: JSON.stringify({\\n      urls,\\n    }),\\n  });\\n};\\n\\nexport const remove = (event) => {\\n  console.log('here', event);\\n};\\n\\n// export const upload = (event) => {\\n// const multipartData = await multipart.parse(event);\\n//   if (multipartData.error) {\\n//     return ({\\n//       statusCode: 500,\\n//       body: JSON.stringify({\\n//         error: true,\\n//         msg: 'Internal Server Error',\\n//         info: 'internal_server_error',\\n//       }),\\n//     });\\n//   }\\n\\n//   const { file, info } = multipartData;\\n//   let fileData, filePath;\\n\\n//   if(types.findIndex(type => type === info.ext) === -1) {\\n//     return ({\\n//       statusCode: 401,\\n//       body: JSON.stringify({\\n//         error: true,\\n//         msg: 'not_support',\\n//         info: 'Image extension not supported',\\n//       }),\\n//     });\\n//   }\\n\\n//   const rootDir = process.cwd();\\n// await imagemin([file.path], rootDir+'/tmp', {\\n//   plugins: [\\n//     imageminJpegRecompress(),\\n//     imageminPngquant({ quality: '50-70' })\\n//   ]\\n// });\\n\\n//   filePath = rootDir + file.path;\\n//   fileData = await fileSystem.read(filePath);\\n//   const key = `image/${id}/${info.ext}/${fileId}.${info.ext}`;\\n\\n//   const result =\\n// await s3.upload(fileData, key, info.contentType, event.stageVariables.bucketName);\\n//   fileSystem.delete(filePath);\\n// }\\n\",\"module.exports = require(\\\"aws-sdk\\\");\",\"module.exports = require(\\\"base64-img\\\");\",\"module.exports = require(\\\"dotenv\\\");\",\"module.exports = require(\\\"fs\\\");\",\"module.exports = require(\\\"imagemin\\\");\",\"module.exports = require(\\\"imagemin-jpeg-recompress\\\");\"]}","code":"module.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=\"./index.js\")}({\"./index.js\":\n/*!******************!*\\\n  !*** ./index.js ***!\n  \\******************/\n/*! exports provided: uploadImagesFunction, fake */function(e,t,r){\"use strict\";r.r(t),r.d(t,\"uploadImagesFunction\",function(){return a}),r.d(t,\"fake\",function(){return s});var o=r(/*! dotenv */\"dotenv\"),i=r.n(o),n=r(/*! ./src/images */\"./src/images.js\");i.a.config();const a=n.upload,s=()=>null},\"./src/aws.repository.js\":\n/*!*******************************!*\\\n  !*** ./src/aws.repository.js ***!\n  \\*******************************/\n/*! exports provided: default */function(e,t,r){\"use strict\";r.r(t);var o=r(/*! aws-sdk */\"aws-sdk\");const i=new(r.n(o).a.S3)({signatureVersion:\"v4\"});t.default={upload:(e,t,r=null,o=\"som-dev-storage\")=>{console.log(\"Bucket: \",o);const n={Body:e,Bucket:o,Key:t,ACL:\"public-read\"};return r&&(n.ContentType=r),new Promise((e,t)=>{i.upload(n,(r,o)=>{r?t(r):e(o)})})}}},\"./src/images.js\":\n/*!***********************!*\\\n  !*** ./src/images.js ***!\n  \\***********************/\n/*! exports provided: upload, remove */function(e,t,r){\"use strict\";r.r(t),r.d(t,\"upload\",function(){return p}),r.d(t,\"remove\",function(){return m});var o=r(/*! base64-img */\"base64-img\"),i=r.n(o),n=r(/*! imagemin */\"imagemin\"),a=r.n(n),s=r(/*! imagemin-jpeg-recompress */\"imagemin-jpeg-recompress\"),u=r.n(s),l=r(/*! fs */\"fs\"),c=r.n(l),d=r(/*! ./aws.repository */\"./src/aws.repository.js\");const p=async e=>{const{file:t,id:r}=JSON.parse(e.body),o=`${(new Date).getTime()}`,n=t.replace(/^data:image\\/\\w+;base64,/,\"\"),s=Buffer.from(n,\"base64\"),l=e=>`images/${r}/jpg/${e}/${o}`,p=await i.a.imgSync(`data:image/jpg;base64,${n}`,\"/tmp/originals/\",o);await a()([p],\"/tmp/mimifieds/\",{plugins:[u()({loops:4,quality:\"high\"})]}),await a()([p],\"/tmp/thumbnails/\",{plugins:[u()({loops:4,quality:\"low\"})]});const m={};console.log(\"urls: \",m);try{const e=await d.default.upload(s,`${l(\"originals\")}.jpg`,\"image/jpeg\",void 0);m.original=e.Location}catch(e){return console.log(\"Orifinal image error\",e),{statusCode:500,body:JSON.stringify({error:{type:\"upload_original_image\",info:e}})}}try{const e=await c.a.readFileSync(`${\"/tmp/mimifieds/\"+o}.jpg`),t=await d.default.upload(e,`${l(\"mimifieds\")}.jpg`,\"image/jpeg\",void 0);m.mimified=t.Location}catch(e){return console.log(\"mimified image error\",e),{statusCode:500,body:JSON.stringify({error:{type:\"process_mimified_image\",info:e}})}}try{const e=await c.a.readFileSync(`${\"/tmp/thumbnails/\"+o}.jpg`),t=await d.default.upload(e,`${l(\"thumbnails\")}.jpg`,\"image/jpeg\",void 0);m.thumbnail=t.Location}catch(e){return console.log(\"upload image error\",e),{statusCode:500,body:JSON.stringify({error:{type:\"process_thumbnail_image\",info:e}})}}return console.log(\"urls: \",m),{statusCode:200,body:JSON.stringify({urls:m})}},m=e=>{console.log(\"here\",e)}},\"aws-sdk\":\n/*!**************************!*\\\n  !*** external \"aws-sdk\" ***!\n  \\**************************/\n/*! no static exports found */function(e,t){e.exports=require(\"aws-sdk\")},\"base64-img\":\n/*!*****************************!*\\\n  !*** external \"base64-img\" ***!\n  \\*****************************/\n/*! no static exports found */function(e,t){e.exports=require(\"base64-img\")},dotenv:\n/*!*************************!*\\\n  !*** external \"dotenv\" ***!\n  \\*************************/\n/*! no static exports found */function(e,t){e.exports=require(\"dotenv\")},fs:\n/*!*********************!*\\\n  !*** external \"fs\" ***!\n  \\*********************/\n/*! no static exports found */function(e,t){e.exports=require(\"fs\")},imagemin:\n/*!***************************!*\\\n  !*** external \"imagemin\" ***!\n  \\***************************/\n/*! no static exports found */function(e,t){e.exports=require(\"imagemin\")},\"imagemin-jpeg-recompress\":\n/*!*******************************************!*\\\n  !*** external \"imagemin-jpeg-recompress\" ***!\n  \\*******************************************/\n/*! no static exports found */function(e,t){e.exports=require(\"imagemin-jpeg-recompress\")}});","extractedComments":[]}